<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>壹两仨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="欢迎光顾小店">
<meta property="og:type" content="website">
<meta property="og:title" content="壹两仨">
<meta property="og:url" content="http://charon_hn.gitee.io/blog/index.html">
<meta property="og:site_name" content="壹两仨">
<meta property="og:description" content="欢迎光顾小店">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Charon">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="壹两仨" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">壹两仨</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://charon_hn.gitee.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2021/08/28/Git/" class="article-date">
  <time datetime="2021-08-27T18:40:46.743Z" itemprop="datePublished">2021-08-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2021/08/28/Git/">Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h1><h2 id="什么是版本控制"><a href="#什么是版本控制" class="headerlink" title="什么是版本控制"></a>什么是版本控制</h2><p>版本控制（Revision control）是一种在开发的过程中用于管理我们对文件、目录或工程等内容的修改历史，方便查看更改历史记录，备份以便恢复以前的版本的软件工程技术。</p>
<ul>
<li>实现跨区域多人协同开发</li>
<li>追踪和记载一个或者多个文件的历史记录</li>
<li>组织和保护你的源代码和文档</li>
<li>统计工作量</li>
<li>并行开发、提高开发效率</li>
<li>跟踪记录整个软件的开发过程</li>
<li>减轻开发人员的负担，节省时间，同时降低人为错误</li>
</ul>
<p>简单说就是用于管理多人协同开发项目的技术。</p>
<p>没有进行版本控制或者版本控制本身缺乏正确的流程管理，在软件开发过程中将会引入很多问题，如软件代码的一致性、软件内容的冗余、软件过程的事物性、软件开发过程中的并发性、软件源代码的安全性，以及软件的整合等问题。</p>
<p>无论是工作还是学习，或者是自己做笔记，都经历过这样一个阶段！我们就迫切需要一个版本控制工具！</p>
<img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0C4qeLxMgoTg9B154ibahsUaibiaV7DgH9GTFQZj3Kyhf5fxrj6G2U5HFg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片" style="zoom:50%;" />

<p>多人开发就必须要使用版本控制！</p>
<h2 id="常见的版本控制工具"><a href="#常见的版本控制工具" class="headerlink" title="常见的版本控制工具"></a>常见的版本控制工具</h2><p>我们学习的东西，一定是当下最流行的！</p>
<p>主流的版本控制器有如下这些：</p>
<ul>
<li><strong>Git</strong></li>
<li><strong>SVN</strong>（Subversion）</li>
<li><strong>CVS</strong>（Concurrent Versions System）</li>
<li><strong>VSS</strong>（Micorosoft Visual SourceSafe）</li>
<li><strong>TFS</strong>（Team Foundation Server）</li>
<li>Visual Studio Online</li>
</ul>
<p>版本控制产品非常的多（Perforce、Rational ClearCase、RCS（GNU Revision Control System）、Serena Dimention、SVK、BitKeeper、Monotone、Bazaar、Mercurial、SourceGear Vault），现在影响力最大且使用最广泛的是Git与SVN</p>
<h2 id="本控制分类"><a href="#本控制分类" class="headerlink" title="本控制分类"></a>本控制分类</h2><h3 id="1、本地版本控制"><a href="#1、本地版本控制" class="headerlink" title="1、本地版本控制"></a>1、本地版本控制</h3><p>记录文件每次的更新，可以对每个版本做一个快照，或是记录补丁文件，适合个人用，如RCS。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0Dg3fHrbPqbNEOMO9GTjFhVaukMZWx54icS7eS2x8A7BEu0VB9ibwEhzQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="2、集中版本控制-SVN"><a href="#2、集中版本控制-SVN" class="headerlink" title="2、集中版本控制  SVN"></a>2、集中版本控制  SVN</h3><p>所有的版本数据都保存在服务器上，协同开发者从服务器上同步更新或上传自己的修改</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p00V4uLaibxtZI9RLpq7tkSdlWiaF92AVeZ0ib9DicqBkS2poo5u8sEU2mCQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>所有的版本数据都存在服务器上，用户的本地只有自己以前所同步的版本，如果不连网的话，用户就看不到历史版本，也无法切换版本验证问题，或在不同分支工作。而且，所有数据都保存在单一的服务器上，有很大的风险这个服务器会损坏，这样就会丢失所有的数据，当然可以定期备份。代表产品：SVN、CVS、VSS</p>
<h3 id="3、分布式版本控制-Git"><a href="#3、分布式版本控制-Git" class="headerlink" title="3、分布式版本控制 Git"></a>3、分布式版本控制 Git</h3><p>每个人都拥有全部的代码！安全隐患！</p>
<p>所有版本信息仓库全部同步到本地的每个用户，这样就可以在本地查看所有版本历史，可以离线在本地提交，只需在连网时push到相应的服务器或其他用户那里。由于每个用户那里保存的都是所有的版本数据，只要有一个用户的设备没有问题就可以恢复所有的数据，但这增加了本地存储空间的占用。</p>
<p>不会因为服务器损坏或者网络问题，造成不能工作的情况！</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0ev8Q7qXjsTfeSwFexdA4tGjFAiaVEKQzAHdGcINXILKflI2cfk9BiawQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="SVN与Git"><a href="#SVN与Git" class="headerlink" title="SVN与Git"></a>SVN与Git</h2><p>SVN是集中式版本控制系统，版本库是集中放在中央服务器的，而工作的时候，用的都是自己的电脑，所以首先要从中央服务器得到最新的版本，然后工作，完成工作后，需要把自己做完的活推送到中央服务器。集中式版本控制系统是必须联网才能工作，对网络带宽要求较高。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0qtEIDr2NG6rOGg1UgDu5c3ffRR8P7FD5D8BPLUEXp0hQoL7qfp3I6g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Git是分布式版本控制系统，没有中央服务器，每个人的电脑就是一个完整的版本库，工作的时候不需要联网了，因为版本都在自己电脑上。协同的方法是这样的：比如说自己在电脑上改了文件A，其他人也在电脑上改了文件A，这时，你们两之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。Git可以直接看到更新了哪些代码和文件！</p>
<p><strong>Git是目前世界上最先进的分布式版本控制系统。</strong></p>
<h1 id="Git历史"><a href="#Git历史" class="headerlink" title="Git历史"></a>Git历史</h1><p>同生活中的许多伟大事物一样，Git 诞生于一个极富纷争大举创新的年代。</p>
<p>Linux 内核开源项目有着为数众广的参与者。绝大多数的 Linux 内核维护工作都花在了提交补丁和保存归档的繁琐事务上(1991－2002年间)。到 2002 年，整个项目组开始启用一个专有的分布式版本控制系统 BitKeeper 来管理和维护代码。</p>
<p>Linux社区中存在很多的大佬！破解研究 BitKeeper ！</p>
<p>到了 2005 年，开发 BitKeeper 的商业公司同 Linux 内核开源社区的合作关系结束，他们收回了 Linux 内核社区免费使用 BitKeeper 的权力。这就迫使 Linux 开源社区(特别是 Linux 的缔造者 Linus Torvalds)基于使用 BitKeeper 时的经验教训，开发出自己的版本系统。（2周左右！） 也就是后来的 Git！</p>
<p><strong>Git是目前世界上最先进的分布式版本控制系统。</strong></p>
<p>Git是免费、开源的，最初Git是为辅助 Linux 内核开发的，来替代 BitKeeper！</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0XGLbyFDUiccCsib4L9Vkg7neJVWupfScbrjd7zm7apC8eYTzgQztNAnA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Linux和Git之父李纳斯·托沃兹（Linus Benedic Torvalds）1969、芬兰</p>
<h1 id="Gti环境配置"><a href="#Gti环境配置" class="headerlink" title="Gti环境配置"></a>Gti环境配置</h1><p>打开 [git官网] <a target="_blank" rel="noopener" href="https://git-scm.com/%EF%BC%8C%E4%B8%8B%E8%BD%BDgit%E5%AF%B9%E5%BA%94%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%89%88%E6%9C%AC%E3%80%82">https://git-scm.com/，下载git对应操作系统的版本。</a></p>
<p>所有东西下载慢的话就可以去找镜像！</p>
<p>官网下载太慢，我们可以使用淘宝镜像下载：<a target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/git-for-windows/">http://npm.taobao.org/mirrors/git-for-windows/</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0IXktseBR7lpvVF4bibFwiaibnGxkDm0wYicPIiaZxcUe2KuibAHj83MiaWFSQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>下载对应的版本即可安装！</p>
<p>安装：无脑下一步即可！安装完毕就可以使用了！</p>
<h2 id="启动Git"><a href="#启动Git" class="headerlink" title="启动Git"></a>启动Git</h2><p>安装成功后在开始菜单中会有Git项，菜单下有3个程序：任意文件夹下右键也可以看到对应的程序！</p>
<p><img src="C:\Users\17212\AppData\Roaming\Typora\typora-user-images\image-20210723153657605.png" alt="image-20210723153657605"></p>
<p><strong>Git Bash：</strong>Unix与Linux风格的命令行，使用最多，推荐最多</p>
<p><strong>Git CMD：</strong>Windows风格的命令行</p>
<p><strong>Git GUI</strong>：图形界面的Git，不建议初学者使用，尽量先熟悉常用命令</p>
<h2 id="常用的Linux命令"><a href="#常用的Linux命令" class="headerlink" title="常用的Linux命令"></a>常用的Linux命令</h2><p>平时一定要多使用这些基础的命令！</p>
<p>1）、cd : 改变目录。</p>
<p>2）、cd . . 回退到上一个目录，直接cd进入默认目录</p>
<p>3）、pwd : 显示当前所在的目录路径。</p>
<p>4）、ls(ll):  都是列出当前目录中的所有文件，只不过ll(两个ll)列出的内容更为详细。</p>
<p>5）、touch : 新建一个文件 如 touch index.js 就会在当前目录下新建一个index.js文件。</p>
<p>6）、rm:  删除一个文件, rm index.js 就会把index.js文件删除。</p>
<p>7）、mkdir:  新建一个目录,就是新建一个文件夹。</p>
<p>8）、rm -r :  删除一个文件夹, rm -r src 删除src目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf / 切勿在Linux中尝试！删除电脑中全部文件！</span><br></pre></td></tr></table></figure>

<p>9）、mv 移动文件, mv index.html src index.html 是我们要移动的文件, src 是目标文件夹,当然, 这样写,必须保证文件和目标文件夹在同一目录下。</p>
<p>10）、reset 重新初始化终端/清屏。</p>
<p>11）、clear 清屏。</p>
<p>12）、history 查看命令历史。</p>
<p>13）、help 帮助。</p>
<p>14）、exit 退出。</p>
<p>15）、#表示注释</p>
<h2 id="Git配置"><a href="#Git配置" class="headerlink" title="Git配置"></a>Git配置</h2><p>所有的配置文件，其实都保存在本地！</p>
<p>查看配置 git config -l</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0GJANibs86DwYqoADdgZySGibmafR8p1XBq6ZG3t0J2wSg9icrIVVQo6dQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>查看不同级别的配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看系统config git config --system --list　　</span><br><span class="line">#查看当前用户（global）配置git config --global  --list</span><br></pre></td></tr></table></figure>

<p><strong>Git相关的配置文件：</strong></p>
<p>1）Git\etc\gitconfig  ：Git 安装目录下的 gitconfig   –system 系统级</p>
<p>2）C:\Users\Administrator\ .gitconfig   只适用于当前登录用户的配置  –global 全局</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0hcJS0rxj3qoCVvfDKh3WxwQJlSV3P15EIZuejraOwXLdic6NCB8X8oQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>这里可以直接编辑配置文件，通过命令设置后会响应到这里。</p>
<h2 id="设置用户名与邮箱（用户标识，必要）"><a href="#设置用户名与邮箱（用户标识，必要）" class="headerlink" title="设置用户名与邮箱（用户标识，必要）"></a>设置用户名与邮箱（用户标识，必要）</h2><p>当你安装Git后首先要做的事情是设置你的用户名称和e-mail地址。这是非常重要的，因为每次Git提交都会使用该信息。它被永远的嵌入到了你的提交中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;kuangshen&quot;  #名称</span><br><span class="line">git config --global user.email 24736743@qq.com   #邮箱</span><br></pre></td></tr></table></figure>

<p>只需要做一次这个设置，如果你传递了–global 选项，因为Git将总是会使用该信息来处理你在系统中所做的一切操作。如果你希望在一个特定的项目中使用不同的名称或e-mail地址，你可以在该项目中运行该命令而不要–global选项。总之–global为全局配置，不加为某个项目的特定配置。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0zQZY37q1iaG0n7445X8YgPVvZH5AqyGvT4RgmoyIcZlJWiaLcxyDgSdQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="Git基本理论（重要）"><a href="#Git基本理论（重要）" class="headerlink" title="Git基本理论（重要）"></a>Git基本理论（重要）</h1><h2 id="三个区域"><a href="#三个区域" class="headerlink" title="三个区域"></a>三个区域</h2><p>Git本地有三个工作区域：工作目录（Working Directory）、暂存区(Stage/Index)、资源库(Repository或Git Directory)。如果在加上远程的git仓库(Remote Directory)就可以分为四个工作区域。文件在这四个区域之间的转换关系如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0NJ4L9OPI9ia1MmibpvDd6cSddBdvrlbdEtyEOrh4CKnWVibyfCHa3lzXw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<ul>
<li>Workspace：工作区，就是你平时存放项目代码的地方</li>
<li>Index / Stage：暂存区，用于临时存放你的改动，事实上它只是一个文件，保存即将提交到文件列表信息</li>
<li>Repository：仓库区（或本地仓库），就是安全存放数据的位置，这里面有你提交到所有版本的数据。其中HEAD指向最新放入仓库的版本</li>
<li>Remote：远程仓库（例如GitHub），托管代码的服务器，可以简单的认为是你项目组中的一台电脑用于远程数据交换</li>
</ul>
<p>本地的三个区域确切的说应该是git仓库中HEAD指向的版本：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0icz6X2aibIgUWzHxtwX8kicPCKpDrsiaPzZk04OlI2bzlydzicBuXTJvLEQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<ul>
<li>Directory：使用Git管理的一个目录，也就是一个仓库，包含我们的工作空间和Git的管理空间。</li>
<li>WorkSpace：需要通过Git进行版本控制的目录和文件，这些目录和文件组成了工作空间。</li>
<li>.git：存放Git管理信息的目录，初始化仓库的时候自动创建。（在windows中是一个隐藏文件夹）</li>
<li>Index/Stage：暂存区，或者叫待提交更新区，在提交进入repo之前，我们可以把所有的更新放在暂存区。</li>
<li>Local Repo：本地仓库，一个存放在本地的版本库；HEAD会只是当前的开发分支（branch）。</li>
<li>Stash：隐藏，是一个工作状态保存栈，用于保存/恢复WorkSpace中的临时状态。</li>
</ul>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p>git的工作流程一般是这样的：</p>
<p>１、在工作目录中添加、修改文件；</p>
<p>２、将需要进行版本管理的文件放入暂存区域；</p>
<p>３、将暂存区域的文件提交到git仓库。</p>
<p>因此，git管理的文件有三种状态：已修改（modified）,已暂存（staged）,已提交(committed)</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p09iaOhl0dACfLrMwNbDzucGQ30s3HnsiaczfcR6dC9OehicuwibKuHjRlzg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="Git项目搭建"><a href="#Git项目搭建" class="headerlink" title="Git项目搭建"></a>Git项目搭建</h1><h2 id="创建工作目录与常用指令"><a href="#创建工作目录与常用指令" class="headerlink" title="创建工作目录与常用指令"></a>创建工作目录与常用指令</h2><p>工作目录（WorkSpace)一般就是你希望Git帮助你管理的文件夹，可以是你项目的目录，也可以是一个空目录，建议不要有中文。</p>
<p>日常使用只要记住下图6个命令：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0AII6YVooUzibpibzJnoOHHXUsL3f9DqA4horUibfcpEZ88Oyf2gQQNR6w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>重点就是push、commit和add这三个命令！！！</p>
<h2 id="本地仓库搭建"><a href="#本地仓库搭建" class="headerlink" title="本地仓库搭建"></a>本地仓库搭建</h2><p>创建本地仓库的方法有两种：一种是创建全新的仓库，另一种是克隆远程仓库。</p>
<p>1、创建全新的仓库，需要用GIT管理的项目的根目录执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在当前目录新建一个Git代码库</span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure>

<p>2、执行后可以看到，仅仅在项目目录多出了一个.git目录，关于版本等的所有信息都在这个目录里面。</p>
<h2 id="克隆远程仓库"><a href="#克隆远程仓库" class="headerlink" title="克隆远程仓库"></a>克隆远程仓库</h2><p>1、另一种方式是克隆远程目录，由于是将远程服务器上的仓库完全镜像一份至本地！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 克隆一个项目和它的整个代码历史(版本信息)</span><br><span class="line">$ git clone [url]  # https://gitee.com/kuangstudy/openclass.git</span><br></pre></td></tr></table></figure>

<p>2、去 gitee 或者 github 上克隆一个测试！</p>
<h1 id="Git文件操作"><a href="#Git文件操作" class="headerlink" title="Git文件操作"></a>Git文件操作</h1><h2 id="文件的四种状态"><a href="#文件的四种状态" class="headerlink" title="文件的四种状态"></a>文件的四种状态</h2><p>版本控制就是对文件的版本控制，要对文件进行修改、提交等操作，首先要知道文件当前在什么状态，不然可能会提交了现在还不想提交的文件，或者要提交的文件没提交上。</p>
<ul>
<li>Untracked: 未跟踪, 此文件在文件夹中, 但并没有加入到git库, 不参与版本控制. 通过==git add==状态变为==Staged==；</li>
<li>Unmodify: 文件已经入库, 未修改, 即版本库中的文件快照内容与文件夹中完全一致. 这种类型的文件有两种去处, 如果它被修改, 而变为==Modified==. 如果使用==git rm==移出版本库, 则成为==Untracked==文件；</li>
<li>Modified: 文件已修改, 仅仅是修改, 并没有进行其他的操作. 这个文件也有两个去处, 通过==git add==可进入暂存==staged==状态, 使用==git checkout== 则丢弃修改过, 返回到==unmodify==状态, 这个==git checkout==即从库中取出文件, 覆盖当前修改 !</li>
<li>Staged: 暂存状态. 执行==git commit==则将修改同步到库中, 这时库中的文件和本地文件又变为一致, 文件为==Unmodify==状态. 执行==git reset HEAD filename==取消暂存, 文件状态为==Modified==；</li>
</ul>
<h2 id="查看文件状态"><a href="#查看文件状态" class="headerlink" title="查看文件状态"></a>查看文件状态</h2><p>上面说文件有4种状态，通过如下命令可以查看到文件的状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#查看指定文件状态</span><br><span class="line">git status [filename]</span><br><span class="line"></span><br><span class="line">#查看所有文件状态</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"># git add .                  添加所有文件到暂存区</span><br><span class="line"># git commit -m &quot;消息内容&quot;    提交暂存区中的内容到本地仓库 -m 提交信息</span><br></pre></td></tr></table></figure>

<h2 id="状态简览"><a href="#状态简览" class="headerlink" title="状态简览"></a>状态简览</h2><p><code>git status</code> 命令的输出十分详细，但其用语有些繁琐。 Git 有一个选项可以帮你缩短状态命令的输出，这样可以以简洁的方式查看更改。 如果你使用 <code>git status -s</code> 命令或 <code>git status --short</code> 命令，你将得到一种格式更为紧凑的输出。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status -s</span></span><br><span class="line"> M README</span><br><span class="line">MM Rakefile</span><br><span class="line">A  lib/git.rb</span><br><span class="line">M  lib/simplegit.rb</span><br><span class="line">?? LICENSE.txt</span><br></pre></td></tr></table></figure>

<p>新添加的未跟踪文件前面有 <code>??</code> 标记，新添加到暂存区中的文件前面有 <code>A</code> 标记，修改过的文件前面有 <code>M</code> 标记。 输出中有两栏，左栏指明了暂存区的状态，右栏指明了工作区的状态。例如，上面的状态报告显示： <code>README</code> 文件在工作区已修改但尚未暂存，而 <code>lib/simplegit.rb</code> 文件已修改且已暂存。 <code>Rakefile</code> 文件已修，暂存后又作了修改，因此该文件的修改中既有已暂存的部分，又有未暂存的部分。</p>
<h2 id="忽略文件"><a href="#忽略文件" class="headerlink" title="忽略文件"></a>忽略文件</h2><p>有些时候我们不想把某些文件纳入版本控制中，比如数据库文件，临时文件，设计文件等</p>
<p>在主目录下建立”.gitignore”文件，此文件有如下规则：</p>
<ol>
<li>忽略文件中的空行或以井号（#）开始的行将会被忽略。</li>
<li>可以使用Linux通配符。例如：星号（*）代表任意多个字符，问号（？）代表一个字符，方括号（[abc]）代表可选字符范围，大括号（{string1,string2,…}）代表可选的字符串等。</li>
<li>如果名称的最前面有一个感叹号（!），表示例外规则，将不被忽略。</li>
<li>如果名称的最前面是一个路径分隔符（/），表示要忽略的文件在此目录下，而子目录中的文件不忽略。</li>
<li>如果名称的最后面是一个路径分隔符（/），表示要忽略的是此目录下该名称的子目录，而非文件（默认文件或目录都忽略）。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#为注释</span><br><span class="line">*.txt        #忽略所有 .txt结尾的文件,这样的话上传就不会被选中！</span><br><span class="line">!lib.txt     #但lib.txt除外</span><br><span class="line">/TODO        #只忽略当前目录下的 TODO 文件，而不忽略 subdir/TODO(忽略TODO以前的)</span><br><span class="line">build/       #忽略build/目录下的所有文件</span><br><span class="line">doc/*.txt    #会忽略 doc/notes.txt 但不包括 doc/server/arch.txt</span><br></pre></td></tr></table></figure>

<h2 id="查看已暂存和未暂存的修改"><a href="#查看已暂存和未暂存的修改" class="headerlink" title="查看已暂存和未暂存的修改"></a>查看已暂存和未暂存的修改</h2><p>如果 <code>git status</code> 命令的输出对于你来说过于简略，而你想知道具体修改了什么地方，可以用 <code>git diff</code> 命令。 稍后我们会详细介绍 <code>git diff</code>，你通常可能会用它来回答这两个问题：当前做的哪些更新尚未暂存？ 有哪些更新已暂存并准备好下次提交？ 虽然 <code>git status</code> 已经通过在相应栏下列出文件名的方式回答了这个问题，但 <code>git diff</code> 能通过文件补丁的格式更加具体地显示哪些行发生了改变。</p>
<p>假如再次修改 README 文件后暂存，然后编辑 <code>CONTRIBUTING.md</code> 文件后先不暂存， 运行 <code>status</code> 命令将会看到：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">    modified:   README</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>

<p>要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 <code>git diff</code>：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git diff</span></span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 8ebb991..643e24f 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -65,7 +65,8 @@ branch directly, things can get messy.</span><br><span class="line"> Please include a nice description of your changes when you submit your PR;</span><br><span class="line"> if we have to read the whole diff to figure out why you&#x27;re contributing</span><br><span class="line"> in the first place, you&#x27;re less likely to get feedback and have your change</span><br><span class="line">-merged in.</span><br><span class="line">+merged in. Also, split your changes into comprehensive chunks if your patch is</span><br><span class="line">+longer than a dozen lines.</span><br><span class="line"></span><br><span class="line"> If you are starting to work on a particular area, feel free to submit a PR</span><br><span class="line"> that highlights your work in progress (and note in the PR title that it&#x27;s</span><br></pre></td></tr></table></figure>

<p>此命令比较的是工作目录中当前文件和暂存区域快照之间的差异。 也就是修改之后还没有暂存起来的变化内容。</p>
<p>若要查看已暂存的将要添加到下次提交里的内容，可以用 <code>git diff --staged</code> 命令。 这条命令将比对已暂存文件与最后一次提交的文件差异：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git diff --staged</span></span><br><span class="line">diff --git a/README b/README</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..03902a1</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/README</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+My Project</span><br></pre></td></tr></table></figure>

<p>请注意，git diff 本身只显示尚未暂存的改动，而不是自上次提交以来所做的所有改动。 所以有时候你一下子暂存了所有更新过的文件，运行 <code>git diff</code> 后却什么也没有，就是这个原因。</p>
<p>像之前说的，暂存 <code>CONTRIBUTING.md</code> 后再编辑，可以使用 <code>git status</code> 查看已被暂存的修改或未被暂存的修改。 如果我们的环境（终端输出）看起来如下：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git add CONTRIBUTING.md</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;# test line&#x27;</span> &gt;&gt; CONTRIBUTING.md</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>

<p>现在运行 <code>git diff</code> 看暂存前后的变化：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git diff</span></span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 643e24f..87f08c8 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -119,3 +119,4 @@ at the</span><br><span class="line"><span class="meta"> #</span><span class="bash"><span class="comment"># Starter Projects</span></span></span><br><span class="line"></span><br><span class="line"> See our [projects list](https://github.com/libgit2/libgit2/blob/development/PROJECTS.md).</span><br><span class="line">+# test line</span><br></pre></td></tr></table></figure>

<p>然后用 <code>git diff --cached</code> 查看已经暂存起来的变化（ <code>--staged</code> 和 <code>--cached</code> 是同义词）：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git diff --cached</span></span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 8ebb991..643e24f 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -65,7 +65,8 @@ branch directly, things can get messy.</span><br><span class="line"> Please include a nice description of your changes when you submit your PR;</span><br><span class="line"> if we have to read the whole diff to figure out why you&#x27;re contributing</span><br><span class="line"> in the first place, you&#x27;re less likely to get feedback and have your change</span><br><span class="line">-merged in.</span><br><span class="line">+merged in. Also, split your changes into comprehensive chunks if your patch is</span><br><span class="line">+longer than a dozen lines.</span><br><span class="line"></span><br><span class="line"> If you are starting to work on a particular area, feel free to submit a PR</span><br><span class="line"> that highlights your work in progress (and note in the PR title that it&#x27;s</span><br></pre></td></tr></table></figure>

<h2 id="提交更新"><a href="#提交更新" class="headerlink" title="提交更新"></a>提交更新</h2><p>现在的暂存区已经准备就绪，可以提交了。 在此之前，请务必确认还有什么已修改或新建的文件还没有 <code>git add</code> 过， 否则提交的时候不会记录这些尚未暂存的变化。 ==这些已修改但未暂存的文件只会保留在本地磁盘==。 所以，每次准备提交前，先用 <code>git status</code> 看下，你所需要的文件是不是都已暂存起来了， 然后再运行提交命令 <code>git commit</code>：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git commit</span></span><br></pre></td></tr></table></figure>

<p>这样会启动你选择的文本编辑器来输入提交说明。</p>
<p><code>git commit -m &quot;需要添加的注释内容&quot;</code></p>
<h2 id="跳过使用暂存区域"><a href="#跳过使用暂存区域" class="headerlink" title="跳过使用暂存区域"></a>跳过使用暂存区域</h2><p>尽管使用暂存区域的方式可以精心准备要提交的细节，但有时候这么做略显繁琐。 Git 提供了一个跳过使用暂存区域的方式， 只要在提交的时候，给 <code>git commit</code> 加上 <code>-a</code> 选项，Git 就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过 <code>git add</code> 步骤：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -a -m <span class="string">&#x27;added new benchmarks&#x27;</span></span></span><br><span class="line">[master 83e38c7] added new benchmarks</span><br><span class="line"> 1 file changed, 5 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>

<p>看到了吗？提交之前不再需要 <code>git add</code> 文件“CONTRIBUTING.md”了。 这是因为 <code>-a</code> 选项使本次提交包含了所有修改过的文件。 这很方便，但是要小心，有时这个选项会将不需要的文件添加到提交中。</p>
<h2 id="移除文件"><a href="#移除文件" class="headerlink" title="移除文件"></a>移除文件</h2><p>要从 Git 中移除某个文件，就必须要从已跟踪文件清单中移除（确切地说，是从暂存区域移除），然后提交。 可以用 <code>git rm</code> 命令完成此项工作，并连带从工作目录中删除指定的文件，这样以后就不会出现在未跟踪文件清单中了。</p>
<p>如果只是简单地从工作目录中手工删除文件，运行 <code>git status</code> 时就会在 “Changes not staged for commit” 部分（也就是 <em>未暂存清单</em>）看到：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rm PROJECTS.md</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add/rm &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        deleted:    PROJECTS.md</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>

<p>然后再运行 <code>git rm</code> 记录此次移除文件的操作：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm PROJECTS.md</span></span><br><span class="line">rm &#x27;PROJECTS.md&#x27;</span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">    deleted:    PROJECTS.md</span><br></pre></td></tr></table></figure>

<p>下一次提交时，该文件就不再纳入版本管理了。 如果要删除之前修改过或已经放到暂存区的文件，则必须使用强制删除选项 <code>-f</code>（译注：即 force 的首字母）。 这是一种安全特性，用于防止误删尚未添加到快照的数据，这样的数据不能被 Git 恢复。</p>
<p>另外一种情况是，我们想把文件从 Git 仓库中删除（亦即从暂存区域移除），但仍然希望保留在当前工作目录中。 换句话说，你想让文件保留在磁盘，但是并不想让 Git 继续跟踪。 当你忘记添加 <code>.gitignore</code> 文件，不小心把一个很大的日志文件或一堆 <code>.a</code> 这样的编译生成文件添加到暂存区时，这一做法尤其有用。 为达到这一目的，使用 <code>--cached</code> 选项：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm --cached README</span></span><br></pre></td></tr></table></figure>

<p><code>git rm</code> 命令后面可以列出文件或者目录的名字，也可以使用 <code>glob</code> 模式。比如：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm <span class="built_in">log</span>/\*.<span class="built_in">log</span></span></span><br></pre></td></tr></table></figure>

<p>注意到星号 <code>*</code> 之前的反斜杠 <code>\</code>， 因为 Git 有它自己的文件模式扩展匹配方式，所以我们不用 shell 来帮忙展开。 此命令删除 <code>log/</code> 目录下扩展名为 <code>.log</code> 的所有文件。 类似的比如：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm \*~</span></span><br></pre></td></tr></table></figure>

<p>该命令会删除所有名字以 <code>~</code> 结尾的文件。</p>
<h2 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h2><p>不像其它的 VCS 系统，Git 并不显式跟踪文件移动操作。 如果在 Git 中重命名了某个文件，仓库中存储的元数据并不会体现出这是一次改名操作。 不过 Git 非常聪明，它会推断出究竟发生了什么，至于具体是如何做到的，我们稍后再谈。</p>
<p>既然如此，当你看到 Git 的 <code>mv</code> 命令时一定会困惑不已。 要在 Git 中对文件改名，可以这么做：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git mv file_from file_to</span></span><br></pre></td></tr></table></figure>

<p>它会恰如预期般正常工作。 实际上，即便此时查看状态信息，也会明白无误地看到关于重命名操作的说明：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git mv README.md README</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#x27;origin/master&#x27;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br></pre></td></tr></table></figure>

<p>其实，运行 <code>git mv</code> 就相当于运行了下面三条命令：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mv README.md README</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rm README.md</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add README</span></span><br></pre></td></tr></table></figure>

<p>如此分开操作，Git 也会意识到这是一次重命名，所以不管何种方式结果都一样。 两者唯一的区别是，<code>mv</code> 是一条命令而非三条命令，直接用 <code>git mv</code> 方便得多。 不过有时候用其他工具批处理重命名的话，要记得在提交前删除旧的文件名，再添加新的文件名。</p>
<h1 id="使用码云"><a href="#使用码云" class="headerlink" title="使用码云"></a>使用码云</h1><blockquote>
<p>github 是有墙的，比较慢，在国内的话，我们一般使用 gitee ，公司中有时候会搭建自己的gitlab服务器</p>
</blockquote>
<p>这个其实可以作为大家未来找工作的一个重要信息！</p>
<p>1、注册登录码云，完善个人信息;</p>
<p>2、设置本机绑定SSH公钥，实现免密码登录！（免密码登录，这一步挺重要的，码云是远程仓库，我们是平时工作在本地仓库！);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 生成公钥（你需要进入对应你想要建立仓库的目录下执行下面的指令）</span><br><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p>比如先创建一个文件夹test2（不添加任何东西，是一个空文件夹），然后去进入到test2文件夹中</p>
<p><img src="C:\Users\17212\AppData\Roaming\Typora\typora-user-images\image-20210723231440473.png" alt="image-20210723231440473"></p>
<p>执行上述生成公钥的指令，会在C/Users/用户名/.ssh目录下生成密钥：</p>
<p><img src="C:\Users\17212\AppData\Roaming\Typora\typora-user-images\image-20210723232801400.png" alt="image-20210723232801400"></p>
<p>3、将公钥信息public key 添加到码云账户中即可！</p>
<p>4、使用码云创建一个自己的仓库！</p>
<h1 id="Git分支"><a href="#Git分支" class="headerlink" title="Git分支"></a>Git分支</h1><p>分支在GIT中相对较难，分支就是科幻电影里面的平行宇宙，如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，在某个时间点，两个平行宇宙合并了，我们就需要处理一些问题了！</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0BOGzaG4QTc4JXO0hSlwcNtujNzAvxeibSrajLYLCT6otNnHDV9xYWwA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0Ayn87woxfepOhSlUj4FQTFUsia4ic0j6aQy4Tz32PRuJ0HSVeGeUzURA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>git分支中常用指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 列出所有本地分支git branch</span><br><span class="line"># 列出所有远程分支git branch -r</span><br><span class="line"># 新建一个分支，但依然停留在当前分支git branch [branch-name]</span><br><span class="line"># 新建一个分支，并切换到该分支git checkout -b [branch]</span><br><span class="line"># 合并指定分支到当前分支$ git merge [branch]</span><br><span class="line"># 删除分支$ git branch -d [branch-name]</span><br><span class="line"># 删除远程分支$ git push origin --delete [branch-name]$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>

<p>IDEA中操作</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0wHNIYeTHC8aHGASoDyZO64QicslqiaMb1OJ1Z1LPoic3LBGyDIYBa7XXw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>如果同一个文件在合并分支时都被修改了则会引起冲突：解决的办法是我们可以修改冲突文件后重新提交！选择要保留他的代码还是你的代码！</p>
<p>==master主分支应该非常稳定，用来发布新版本，一般情况下不允许在上面工作，工作一般情况下在新建的dev分支上工作，工作完后，比如上要发布，或者说dev分支代码稳定后可以合并到主分支master上来。==</p>
<p>学习资源：</p>
<p><img src="C:\Users\17212\AppData\Roaming\Typora\typora-user-images\image-20210724135648786.png" alt="image-20210724135648786">码云footer有一些</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://charon_hn.gitee.io/blog/2021/08/28/Git/" data-id="ckt2xzdwj000b7ktldgf0ezjv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Backpropagation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2021/08/28/Backpropagation/" class="article-date">
  <time datetime="2021-08-27T17:57:44.422Z" itemprop="datePublished">2021-08-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2021/08/28/Backpropagation/">Backpropropagation</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>首先先说一个比较好的视频讲解——<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16x411V7Qg?share_source=copy_web">3B1B</a></p>
<p>自己参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/charlotte77/p/5629865.html">一文弄懂神经网络中的反向传播法——BackPropagation - Charlotte77 - 博客园 (cnblogs.com)</a>进行了一次复现尝试。</p>
<p>代码参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/sunlanchang/article/details/88807820">(17条消息) Python实现一个简单的反向传播算法_sunlanchang的博客-CSDN博客_python 反向传播</a></p>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210814234344504.png" alt="image-20210814234344504">同样，先对上图中的一些图表做一些说明。</p>
<ul>
<li><p>上图主要是由一个输入层，一个隐藏层，一个输出层构成的简单神经网络。</p>
</li>
<li><p>线上的数值代表权重大小w(初始化大小)</p>
</li>
<li><p>Matrix那一块表示forward propagation的结果</p>
</li>
<li><p>其中隐藏层的表示是由两部分组成的，前半部分是权值weight运算的结果，后半部分是使用激活函数的结果(这个地方在求偏导数的时候会用到)</p>
</li>
<li><p>数据集大小为1，也就是(x,y),即(0.05,0.1)和(0.1,0.99)；</p>
<p>或许存在这样的一个疑惑——这不是数据集的大小为2吗(反正我是有这样的疑惑的)？</p>
<p>其实上图中x1和x2是特征的意思，也就是说这个数据集每个输入是包含了两个特征，因此也就存在y1和y2</p>
</li>
</ul>
<p>构建神经网络的目的就是要构造一个模型可以进行非线性的预测，这里就是要不断地去调整权重值weight，使最后的output_h(x1)与output_h(x2)的值近似等于y1和y2。</p>
<h1 id="forward-propagation"><a href="#forward-propagation" class="headerlink" title="forward propagation"></a>forward propagation</h1><p>首先是前向传播，具体的原理已经在《机器学习笔记》中讲到了，这里主要进行体现一个计算的过程。</p>
<h2 id="输入层–-gt-隐藏层"><a href="#输入层–-gt-隐藏层" class="headerlink" title="输入层–&gt;隐藏层"></a>输入层–&gt;隐藏层</h2><p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210814234344504.png" alt="image-20210814234344504"></p>
<p>用公式表示：$hiddenlayer = input\cdot hiddenLayerWeight = \begin{bmatrix}0.05 &amp; 0.1 &amp; 1\end{bmatrix}\begin{bmatrix}0.15 ; 0.2 \ 0.25 ; 0.3\0.35 ; 0.35 \end{bmatrix}$​​</p>
<p>以计算a_1为例：</p>
<p>$a_1 = input_x1 * w1 + input_x2 * w3 + input_x0 * w$​</p>
<p>同样的办法可以计算出a_2；</p>
<p>那么最后隐藏层的输出是如下:</p>
<p>$hiddenoutput = sigmoid(hiddenlayer)–&gt;a(hiddenoutput)=[0.5945 \ 0.5963]$​​，其中sigmoid(a1)​=0.5945，sigmoid(a2)=0.5963</p>
<h2 id="隐藏层–-gt-输出层"><a href="#隐藏层–-gt-输出层" class="headerlink" title="隐藏层–&gt;输出层"></a>隐藏层–&gt;输出层</h2><p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210814234344504.png" alt="image-20210814234344504"></p>
<p>这一步的计算方法其实跟”输入层–&gt;隐藏层“的步骤一致，可以说是完全一样，也是在最后一步的输出需要进行sigmoid函数进行激活(有些地方在最后输出的时候是不需要进行激活的，但是我在这个地方使用了是想突出每一层之间的一致性)。</p>
<p>可以发现最后的输出结果是0.7569和0.7677，这两个值与真实值0.1和0.99还是相差一些的。</p>
<h1 id="back-propagation"><a href="#back-propagation" class="headerlink" title="back propagation"></a>back propagation</h1><p>经过一遍的前向传播，我们可以得到loss，也就是cost function的输出。</p>
<p>为了便于计算，这里表示cost function的时候就不做regularization处理了，直接定义cost function=$\sum(h-y)^2$。</p>
<h2 id="计算误差"><a href="#计算误差" class="headerlink" title="计算误差"></a>计算误差</h2><p>loss = =$\sum(h-y)^2$=0.48096888248109915。这个差值是两个输出值的结果，不是一个的。</p>
<p>用矩阵运算表示结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = np.square(y - h).<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>

<h2 id="输出层–-gt-隐藏层"><a href="#输出层–-gt-隐藏层" class="headerlink" title="输出层–&gt;隐藏层"></a>输出层–&gt;隐藏层</h2><p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210814234344504.png" alt="image-20210814234344504"></p>
<p>我们假设求w5对结果的影响值，也就是$\frac{\partial loss}{\partial w5}$​.</p>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815011749186.png" alt="image-20210815011749186"></p>
<p>如上图所示(蓝色的箭头表示求偏导)，根据链式求导法则(一般形式表示):</p>
<p><font size=5>$\boldsymbol {\frac{\partial loss}{\partial w5} = \frac{\partial loss}{\partial h}*\frac{\partial h}{\partial outputlayer}*\frac{\partial outputlayer}{\partial w5}}$ </font></p>
<h3 id="1-frac-partial-loss-partial-h-​​​​​​​​"><a href="#1-frac-partial-loss-partial-h-​​​​​​​​" class="headerlink" title="1.$\frac{\partial loss}{\partial h}$​​​​​​​​:"></a>1.<font size=4>$\frac{\partial loss}{\partial h}$​​​​​​​​</font>:</h3><p>这部分简单，直接对loss函数求偏导数即可，即$\frac{\partial loss}{\partial h}=-2*(y-h)=-2.0*(0.1 - 0.7569)$</p>
<h3 id="2-frac-partial-h-partial-outputlayer-​​"><a href="#2-frac-partial-h-partial-outputlayer-​​" class="headerlink" title="2.$\frac{\partial h}{\partial outputlayer}$​​:"></a>2.<font size=4>$\frac{\partial h}{\partial outputlayer}$​​</font>:</h3><p>要知道，h=sigmoid(outputlayer),根据sigmoid函数的性质——$sigmoid’(x)=sigmoid(x)*(1-sigmoid(x))$</p>
<p>因此$\frac{\partial h}{\partial outputlayer}=siogmoid(outputlayer)<em>(1-sigmoid(outputlayer))=h</em>(1-h)=0.7569*(1-0.7569)$</p>
<blockquote>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815112836155.png" alt="image-20210815112836155" style="zoom:50%;" />即图中红框的位置</p>
</blockquote>
<h3 id="3-frac-partial-outputlayer-partial-w5-​"><a href="#3-frac-partial-outputlayer-partial-w5-​" class="headerlink" title="3.$\frac{\partial outputlayer}{\partial w5}$​:"></a>3.<font size=4>$\frac{\partial outputlayer}{\partial w5}$​</font>:</h3><p>因为$outputlayer = hiddenoutput1 * w5 + hiddenoutput2 * w7 + hiddenoutput0 * w$；</p>
<p>因此便可以得到$\frac{\partial outputlayer}{\partial w5}=hiddenoutput1=0.5945$​​​</p>
<blockquote>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815112549250.png" alt="image-20210815112549250" style="zoom: 50%;" />就是图中红框的位置的数值</p>
</blockquote>
<p>用同样的方法可以计算出w6，w7等偏导数，在代码中主要是以矩阵的形式来表示进行运算的。</p>
<h3 id="4-一般化"><a href="#4-一般化" class="headerlink" title="4.一般化"></a>4.一般化</h3><p>为了能够一般化，定义$\delta$​表示偏差值，即:</p>
<p>$\delta_{输出层}=\frac{\partial loss}{\partial h}<em>\frac{\partial h}{\partial outputlayer}=-2</em>(y-h)<em>siogmoid(outputlar)</em>(1-sigmoid(outputlar))$​</p>
<p>$\frac{\partial loss}{\partial outputweigth}=\delta_{输出层}*hiddenoutput$​</p>
<blockquote>
<p>在吴恩达的视频中，他也定义了$\delta$表示偏差值，但是他定义的是不含有$\frac{\partial h}{\partial outputlayer}$​​这一部分的，是因为他没有在最后一层中使用sigmoid函数</p>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815180008787.png" alt="image-20210815180008787"></p>
</blockquote>
<blockquote>
<p>吴大佬也讲到了$\delta$的定义是什么：</p>
<img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815182518020.png" alt="image-20210815182518020" style="zoom:50%;" />
</blockquote>
<h3 id="5-代码"><a href="#5-代码" class="headerlink" title="5.代码"></a>5.代码</h3><p>用代码表示如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grad_loss_h = -<span class="number">2.0</span> * (y - h) <span class="comment">#1*2</span></span><br><span class="line">grad_h_outputlayer = Dsigmoid(outputlayer) <span class="comment">#1*2</span></span><br><span class="line">grad_outputlayer_outputweight = addBias(hiddenoutput, <span class="number">1</span>) <span class="comment">#1*3</span></span><br><span class="line">delta_output=grad_h_outputlayer*grad_loss_h <span class="comment">#1*2(这个地方的”*“代表相同位置的乘法，不是矩阵的乘法)</span></span><br><span class="line"><span class="comment"># 这个地方的转置可以这样理解，原来是 1*3的矩阵.dot(3*2的矩阵)=1*2的矩阵，那么现在想要得到这个3*2的矩阵</span></span><br><span class="line"><span class="comment"># 那就等号两边同时乘以这1*3矩阵的转置，即3*1.dot(1*3).dot(3*2)=3*3.dot(3*2)=3*2=3*1.dot(1*2) ps:在数学的角度上肯定是不对的</span></span><br><span class="line">grad_outputLayer = np.expand_dims(grad_outputlayer_outputweight, axis=<span class="number">0</span>).T.dot(np.expand_dims(delta_output, axis=<span class="number">0</span>)) <span class="comment">#3*2</span></span><br></pre></td></tr></table></figure>

<p>更新权值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outputweight -= learning_rate*grad_outputLayer <span class="comment">#学习率这里取0.5</span></span><br></pre></td></tr></table></figure>





<h2 id="隐藏层–-gt-输入层"><a href="#隐藏层–-gt-输入层" class="headerlink" title="隐藏层–&gt;输入层"></a>隐藏层–&gt;输入层</h2><p>其实大体上与”输出层–&gt;隐藏层“的处理步骤差不多。</p>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210814234344504.png" alt="image-20210814234344504"></p>
<p>这里以对w1求偏导数为例，求导示例图如下所示：</p>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815144823440.png" alt="image-20210815144823440.png"></p>
<p>还是需要应用到链式求导法则(一般形式表示)：</p>
<p><font size=4>$\frac{\partial loss}{\partial w1}=\frac{\partial loss}{\partial hiddenoutput}*\frac{\partial hiddenoutput}{\partial hiddenlayer}*\frac{\partial hiddenlayer}{\partial w1}\newline$​​​​​</font></p>
<p>​                <font size=5>$=\frac{\partial loss}{\partial h}*\frac{\partial h}{\partial outputlayer}*\frac{\partial outputlayer}{\partial hiddenoutput}*\frac{\partial hiddenoutput}{\partial hiddenlayer}*\frac{\partial hiddenlayer}{\partial w1}$​​</font></p>
<p>在”输出层–&gt;隐藏层”中提到过，我们令$\delta_{输出层}=\frac{\partial loss}{\partial h}*\frac{\partial h}{\partial outputlayer}$​，那么可以对上式进行化简如下：</p>
<p><font size=5>$\frac{\partial loss}{\partial w1}=\delta_{输出层}*\frac{\partial outputlayer}{\partial hiddenoutput}*\frac{\partial hiddenoutput}{\partial hiddenlayer}*\frac{\partial hiddenlayer}{\partial w1}$</font></p>
<p>那么剩下的就是求$\frac{\partial outputlayer}{\partial hiddenoutput};\frac{\partial hiddenoutput}{\partial hiddenlayer};\frac{\partial hiddenlayer}{\partial w1}$这三项</p>
<h3 id="1-frac-partial-outputlayer-partial-hiddenoutput-​​"><a href="#1-frac-partial-outputlayer-partial-hiddenoutput-​​" class="headerlink" title="1.$\frac{\partial outputlayer}{\partial hiddenoutput}$​​"></a>1.<font size=4>$\frac{\partial outputlayer}{\partial hiddenoutput}$​​</font></h3><p>在计算的时候需要注意有两个输出，也即<font size=4>$\frac{\partial outputlayer}{\partial hiddenoutput}=\frac{\partial outputlayer1}{\partial hiddenoutput}+\frac{\partial outputlayer2}{\partial hiddenoutput}$</font>。</p>
<p>其中$\frac{\partial outputlayer1}{\partial hiddenoutput}=w5=0.4，\frac{\partial outputlayer1}{\partial hiddenoutput}=w6=0.45$​</p>
<h3 id="2-frac-partial-hiddenoutput-partial-hiddenlayer-​​"><a href="#2-frac-partial-hiddenoutput-partial-hiddenlayer-​​" class="headerlink" title="2.$\frac{\partial hiddenoutput}{\partial hiddenlayer}$​​"></a>2.<font size =4>$\frac{\partial hiddenoutput}{\partial hiddenlayer}$​​</font></h3><p>因为存在hiddenoutput = Sigmoid(hiddenlaye)这个函数关系，因此：</p>
<p>$\frac{\partial hiddenoutput}{\partial hiddenlayer}=hiddenoutput*(1-hiddenoutput)=0.5945*(1-0.5945)$</p>
<p><img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815112549250.png" alt="image-20210815112549250" style="zoom: 50%;" />就是图中红框的数值</p>
<h3 id="3-frac-partial-hiddenlayer-partial-w1-​"><a href="#3-frac-partial-hiddenlayer-partial-w1-​" class="headerlink" title="3.$\frac{\partial hiddenlayer}{\partial w1}$​:"></a>3.<font size=4>$\frac{\partial hiddenlayer}{\partial w1}$​</font>:</h3><p>因为因为$hiddenlayer = input_x1 * w1 + input_x2 * w3 + input_x0 * w$​</p>
<p>所以$\frac{\partial hiddenlayer}{\partial w1}=input_x1=x1=0.05$</p>
<h3 id="4-一般化-1"><a href="#4-一般化-1" class="headerlink" title="4.一般化"></a>4.一般化</h3><p>令$\delta_{隐藏层}=\delta_{输出层}*\frac{\partial outputlayer}{\partial hiddenoutput}*\frac{\partial hiddenoutput}{\partial hiddenlayer}$</p>
<blockquote>
<p>其实这个地方要是这样写的话(本质上是一致的，$\frac{\partial outputlayer}{\partial hiddenoutput}=(\Theta^{(2)})^T$,但是我不知道为什么要这样计算，为什么要转置我没有从数学逻辑上想到严谨的理由)：</p>
<p>$\delta_{隐藏层}=\frac{\partial outputlayer}{\partial hiddenoutput}*\delta_{输出层}*\frac{\partial hiddenoutput}{\partial hiddenlayer}$</p>
<p>就更加符合吴大佬所定义的误差值了：</p>
<img src="https://raw.githubusercontent.com/Charon-HN/images/master/Typora/image-20210815180349394.png" alt="image-20210815180349394" style="zoom: 50%;" />

<p>实际上在写代码的时候，确实是将这个weight矩阵进行了转置的处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grad_hiddenlayer = np.dot(np.expand_dims(grad_hiddenlayer_hiddenweight, axis=<span class="number">0</span>).T, np.expand_dims(delta_hidden, axis=<span class="number">0</span>))</span><br></pre></td></tr></table></figure>
</blockquote>
<p>故$\frac{\partial loss}{\partial w1}=\delta_{隐藏层}*input_x1$​​</p>
<h3 id="5-代码-1"><a href="#5-代码-1" class="headerlink" title="5.代码"></a>5.代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grad_outputlayer_hiddenoutput = outputweight <span class="comment">#3*2</span></span><br><span class="line">grad_hiddenoutput_hiddenlayer = Dsigmoid(hiddenlayer) <span class="comment">#1*2</span></span><br><span class="line">grad_hiddenlayer_hiddenweight = addBias(x, <span class="number">1</span>) <span class="comment">#1*3</span></span><br><span class="line"><span class="comment">#不考虑bias的影响，因此要删除</span></span><br><span class="line">delta_hidden = np.delete(np.dot(delta_output, grad_outputlayer_hiddenoutput.T), <span class="number">0</span>) * grad_hiddenoutput_hiddenlayer</span><br><span class="line">grad_hiddenlayer = np.dot(np.expand_dims(grad_hiddenlayer_hiddenweight, axis=<span class="number">0</span>).T, np.expand_dims(delta_hidden, axis=<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<p>更新：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hiddenweight -= learning_rate*grad_hiddenlayer</span><br></pre></td></tr></table></figure>





<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment">#数据集个数</span></span><br><span class="line">M=<span class="number">1</span></span><br><span class="line"><span class="comment">#学习率</span></span><br><span class="line">learning_rate = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#产生随机数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.random.randn(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加bias unit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addBias</span>(<span class="params">matrix, bias</span>):</span> <span class="comment">#这个地方多维我不知道该咋处理</span></span><br><span class="line">   <span class="keyword">return</span> np.append(matrix,bias)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化数据大小</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Init</span>(<span class="params">input_num=<span class="literal">None</span>, input_features=<span class="literal">None</span>, output_num=<span class="literal">None</span>, output_features=<span class="literal">None</span>, is_matrix=<span class="literal">False</span>, input_matrix=<span class="literal">None</span>, output_matrix=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_matrix:</span><br><span class="line">        x = random(input_num, input_features)</span><br><span class="line">        y = random(output_num, output_features)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x = np.array(input_matrix)</span><br><span class="line">        y = np.array(output_matrix)</span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义隐藏层权重</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hiddenLayerWeight</span>(<span class="params">input_x=<span class="literal">None</span>, input_y=<span class="literal">None</span>, is_matrix=<span class="literal">False</span>, input_matrix=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_matrix:</span><br><span class="line">        <span class="keyword">return</span> random(input_x, input_y)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> np.array(input_matrix)</span><br><span class="line"><span class="comment">#定义输出层权重</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ouputLayerWeight</span>(<span class="params">input_x=<span class="literal">None</span>, input_y=<span class="literal">None</span>, is_matrix=<span class="literal">False</span>, input_matrix=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_matrix:</span><br><span class="line">        <span class="keyword">return</span> random(input_x, input_y)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> np.array(input_matrix)</span><br><span class="line"><span class="comment">#卷积计算</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convolution</span>(<span class="params">matrix1, matrix2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.dot(matrix1, matrix2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义激活函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Sigmoid</span>(<span class="params">z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1.0</span> + np.exp(-z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Dsigmoid</span>(<span class="params">z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> Sigmoid(z) * (<span class="number">1</span>-Sigmoid(z))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    x, y = Init(is_matrix=<span class="literal">True</span>, input_matrix=[<span class="number">0.05</span>, <span class="number">0.1</span>], output_matrix=[<span class="number">0.1</span>, <span class="number">0.99</span>])</span><br><span class="line"></span><br><span class="line">    hiddenweight = hiddenLayerWeight(is_matrix=<span class="literal">True</span>, input_matrix=[[<span class="number">0.15</span>, <span class="number">0.2</span>], [<span class="number">0.25</span>, <span class="number">0.3</span>], [<span class="number">0.35</span>, <span class="number">0.35</span>]])</span><br><span class="line">    outputweight = ouputLayerWeight(is_matrix=<span class="literal">True</span>, input_matrix=[[<span class="number">0.4</span>, <span class="number">0.45</span>], [<span class="number">0.5</span>, <span class="number">0.55</span>], [<span class="number">0.6</span>, <span class="number">0.6</span>]])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">        <span class="comment">#forward propagation</span></span><br><span class="line">        hiddenlayer = convolution(addBias(x, <span class="number">1</span>), hiddenweight) <span class="comment">#1*2</span></span><br><span class="line">        <span class="comment"># print(hiddenlayer)</span></span><br><span class="line">        hiddenoutput = Sigmoid(hiddenlayer)</span><br><span class="line">        outputlayer = convolution(addBias(hiddenoutput, <span class="number">1</span>), outputweight)</span><br><span class="line">        h = Sigmoid(outputlayer)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#cost</span></span><br><span class="line">        loss = np.square(y - h).<span class="built_in">sum</span>()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;loss:&quot;</span>, loss)</span><br><span class="line">        <span class="built_in">print</span>(h)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#backpropagation</span></span><br><span class="line">        grad_loss_h = -<span class="number">2.0</span> * (y - h) <span class="comment">#1*2</span></span><br><span class="line">        grad_h_outputlayer = Dsigmoid(outputlayer) <span class="comment">#1*2</span></span><br><span class="line">        grad_outputlayer_outputweight = addBias(hiddenoutput, <span class="number">1</span>) <span class="comment">#1*3</span></span><br><span class="line">        delta_output=grad_h_outputlayer*grad_loss_h <span class="comment">#1*2(这个地方的”*“代表相同位置的乘法，不是矩阵的乘法)</span></span><br><span class="line">        <span class="comment"># 这个地方的转置可以这样理解，原来是 1*3的矩阵.dot(3*2的矩阵)=1*2的矩阵，那么现在想要得到这个3*2的矩阵</span></span><br><span class="line">        <span class="comment"># 那就等号两边同时乘以这1*3矩阵的转置，即3*1.dot(1*3).dot(3*2)=3*3.dot(3*2)=3*2=3*1.dot(1*2) ps:在数学的角度上肯定是不对的</span></span><br><span class="line">        grad_outputLayer = np.expand_dims(grad_outputlayer_outputweight, axis=<span class="number">0</span>).T.dot(np.expand_dims(delta_output, axis=<span class="number">0</span>)) <span class="comment">#3*2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        grad_outputlayer_hiddenoutput = outputweight <span class="comment">#3*2</span></span><br><span class="line">        grad_hiddenoutput_hiddenlayer = Dsigmoid(hiddenlayer) <span class="comment">#1*2</span></span><br><span class="line">        grad_hiddenlayer_hiddenweight = addBias(x, <span class="number">1</span>) <span class="comment">#1*3</span></span><br><span class="line">        <span class="comment">#不考虑bias的影响，因此要删除</span></span><br><span class="line">        delta_hidden = np.delete(np.dot(delta_output, grad_outputlayer_hiddenoutput.T), <span class="number">0</span>) * grad_hiddenoutput_hiddenlayer</span><br><span class="line">        grad_hiddenlayer = np.dot(np.expand_dims(grad_hiddenlayer_hiddenweight, axis=<span class="number">0</span>).T, np.expand_dims(delta_hidden, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#update</span></span><br><span class="line">        outputweight -= learning_rate*grad_outputLayer</span><br><span class="line">        hiddenweight -= learning_rate*grad_hiddenlayer</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://charon_hn.gitee.io/blog/2021/08/28/Backpropagation/" data-id="ckt2xzdwa00047ktl3buc4xc9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">笔记</a> <a href="/blog/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/08/">八月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2021/08/28/Git/">Git</a>
          </li>
        
          <li>
            <a href="/blog/2021/08/28/Backpropagation/">Backpropropagation</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Charon<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">

  
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>